version: '3.8'

# Override pour le développement local
# Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  app:
    build:
      args:
        APP_ENV: local
        INSTALL_XDEBUG: "true"
    environment:
      - APP_DEBUG=true
      - XDEBUG_MODE=develop,debug
      - XDEBUG_CONFIG=client_host=host.docker.internal
    extra_hosts:
      - "host.docker.internal:host-gateway"

  web:
    ports:
      - "8080:80"
      - "8443:443"

  db:
    ports:
      - "5432:5432"

  qdrant:
    ports:
      - "6333:6333"
      - "6334:6334"

  ollama:
    # En dev, on peut utiliser un modèle plus léger
    environment:
      - OLLAMA_KEEP_ALIVE=24h  # Garde le modèle en mémoire
    ports:
      - "11434:11434"
    # Sans GPU en dev (CPU only)
    deploy: {}
